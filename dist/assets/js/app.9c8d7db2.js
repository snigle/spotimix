(function(e){function t(t){for(var i,a,c=t[0],o=t[1],l=t[2],p=0,d=[];p<c.length;p++)a=c[p],Object.prototype.hasOwnProperty.call(n,a)&&n[a]&&d.push(n[a][0]),n[a]=0;for(i in o)Object.prototype.hasOwnProperty.call(o,i)&&(e[i]=o[i]);u&&u(t);while(d.length)d.shift()();return r.push.apply(r,l||[]),s()}function s(){for(var e,t=0;t<r.length;t++){for(var s=r[t],i=!0,c=1;c<s.length;c++){var o=s[c];0!==n[o]&&(i=!1)}i&&(r.splice(t--,1),e=a(a.s=s[0]))}return e}var i={},n={app:0},r=[];function a(t){if(i[t])return i[t].exports;var s=i[t]={i:t,l:!1,exports:{}};return e[t].call(s.exports,s,s.exports,a),s.l=!0,s.exports}a.m=e,a.c=i,a.d=function(e,t,s){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},a.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(a.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)a.d(s,i,function(t){return e[t]}.bind(null,i));return s},a.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="/spotimix/dist/";var c=window["webpackJsonp"]=window["webpackJsonp"]||[],o=c.push.bind(c);c.push=t,c=c.slice();for(var l=0;l<c.length;l++)t(c[l]);var u=o;r.push([0,"chunk-vendors"]),s()})({0:function(e,t,s){e.exports=s("cd49")},1:function(e,t){},4678:function(e,t,s){var i={"./af":"2bfb","./af.js":"2bfb","./ar":"8e73","./ar-dz":"a356","./ar-dz.js":"a356","./ar-kw":"423e","./ar-kw.js":"423e","./ar-ly":"1cfd","./ar-ly.js":"1cfd","./ar-ma":"0a84","./ar-ma.js":"0a84","./ar-sa":"8230","./ar-sa.js":"8230","./ar-tn":"6d83","./ar-tn.js":"6d83","./ar.js":"8e73","./az":"485c","./az.js":"485c","./be":"1fc1","./be.js":"1fc1","./bg":"84aa","./bg.js":"84aa","./bm":"a7fa","./bm.js":"a7fa","./bn":"9043","./bn-bd":"9686","./bn-bd.js":"9686","./bn.js":"9043","./bo":"d26a","./bo.js":"d26a","./br":"6887","./br.js":"6887","./bs":"2554","./bs.js":"2554","./ca":"d716","./ca.js":"d716","./cs":"3c0d","./cs.js":"3c0d","./cv":"03ec","./cv.js":"03ec","./cy":"9797","./cy.js":"9797","./da":"0f14","./da.js":"0f14","./de":"b469","./de-at":"b3eb","./de-at.js":"b3eb","./de-ch":"bb71","./de-ch.js":"bb71","./de.js":"b469","./dv":"598a","./dv.js":"598a","./el":"8d47","./el.js":"8d47","./en-au":"0e6b","./en-au.js":"0e6b","./en-ca":"3886","./en-ca.js":"3886","./en-gb":"39a6","./en-gb.js":"39a6","./en-ie":"e1d3","./en-ie.js":"e1d3","./en-il":"7333","./en-il.js":"7333","./en-in":"ec2e","./en-in.js":"ec2e","./en-nz":"6f50","./en-nz.js":"6f50","./en-sg":"b7e9","./en-sg.js":"b7e9","./eo":"65db","./eo.js":"65db","./es":"898b","./es-do":"0a3c","./es-do.js":"0a3c","./es-mx":"b5b7","./es-mx.js":"b5b7","./es-us":"55c9","./es-us.js":"55c9","./es.js":"898b","./et":"ec18","./et.js":"ec18","./eu":"0ff2","./eu.js":"0ff2","./fa":"8df4","./fa.js":"8df4","./fi":"81e9","./fi.js":"81e9","./fil":"d69a","./fil.js":"d69a","./fo":"0721","./fo.js":"0721","./fr":"9f26","./fr-ca":"d9f8","./fr-ca.js":"d9f8","./fr-ch":"0e49","./fr-ch.js":"0e49","./fr.js":"9f26","./fy":"7118","./fy.js":"7118","./ga":"5120","./ga.js":"5120","./gd":"f6b4","./gd.js":"f6b4","./gl":"8840","./gl.js":"8840","./gom-deva":"aaf2","./gom-deva.js":"aaf2","./gom-latn":"0caa","./gom-latn.js":"0caa","./gu":"e0c5","./gu.js":"e0c5","./he":"c7aa","./he.js":"c7aa","./hi":"dc4d","./hi.js":"dc4d","./hr":"4ba9","./hr.js":"4ba9","./hu":"5b14","./hu.js":"5b14","./hy-am":"d6b6","./hy-am.js":"d6b6","./id":"5038","./id.js":"5038","./is":"0558","./is.js":"0558","./it":"6e98","./it-ch":"6f12","./it-ch.js":"6f12","./it.js":"6e98","./ja":"079e","./ja.js":"079e","./jv":"b540","./jv.js":"b540","./ka":"201b","./ka.js":"201b","./kk":"6d79","./kk.js":"6d79","./km":"e81d","./km.js":"e81d","./kn":"3e92","./kn.js":"3e92","./ko":"22f8","./ko.js":"22f8","./ku":"2421","./ku.js":"2421","./ky":"9609","./ky.js":"9609","./lb":"440c","./lb.js":"440c","./lo":"b29d","./lo.js":"b29d","./lt":"26f9","./lt.js":"26f9","./lv":"b97c","./lv.js":"b97c","./me":"293c","./me.js":"293c","./mi":"688b","./mi.js":"688b","./mk":"6909","./mk.js":"6909","./ml":"02fb","./ml.js":"02fb","./mn":"958b","./mn.js":"958b","./mr":"39bd","./mr.js":"39bd","./ms":"ebe4","./ms-my":"6403","./ms-my.js":"6403","./ms.js":"ebe4","./mt":"1b45","./mt.js":"1b45","./my":"8689","./my.js":"8689","./nb":"6ce3","./nb.js":"6ce3","./ne":"3a39","./ne.js":"3a39","./nl":"facd","./nl-be":"db29","./nl-be.js":"db29","./nl.js":"facd","./nn":"b84c","./nn.js":"b84c","./oc-lnc":"167b","./oc-lnc.js":"167b","./pa-in":"f3ff","./pa-in.js":"f3ff","./pl":"8d57","./pl.js":"8d57","./pt":"f260","./pt-br":"d2d4","./pt-br.js":"d2d4","./pt.js":"f260","./ro":"972c","./ro.js":"972c","./ru":"957c","./ru.js":"957c","./sd":"6784","./sd.js":"6784","./se":"ffff","./se.js":"ffff","./si":"eda5","./si.js":"eda5","./sk":"7be6","./sk.js":"7be6","./sl":"8155","./sl.js":"8155","./sq":"c8f3","./sq.js":"c8f3","./sr":"cf1e","./sr-cyrl":"13e9","./sr-cyrl.js":"13e9","./sr.js":"cf1e","./ss":"52bd","./ss.js":"52bd","./sv":"5fbd","./sv.js":"5fbd","./sw":"74dc","./sw.js":"74dc","./ta":"3de5","./ta.js":"3de5","./te":"5cbb","./te.js":"5cbb","./tet":"576c","./tet.js":"576c","./tg":"3b1b","./tg.js":"3b1b","./th":"10e8","./th.js":"10e8","./tk":"5aff","./tk.js":"5aff","./tl-ph":"0f38","./tl-ph.js":"0f38","./tlh":"cf75","./tlh.js":"cf75","./tr":"0e81","./tr.js":"0e81","./tzl":"cf51","./tzl.js":"cf51","./tzm":"c109","./tzm-latn":"b53d","./tzm-latn.js":"b53d","./tzm.js":"c109","./ug-cn":"6117","./ug-cn.js":"6117","./uk":"ada2","./uk.js":"ada2","./ur":"5294","./ur.js":"5294","./uz":"2e8c","./uz-latn":"010e","./uz-latn.js":"010e","./uz.js":"2e8c","./vi":"2921","./vi.js":"2921","./x-pseudo":"fd7e","./x-pseudo.js":"fd7e","./yo":"7f33","./yo.js":"7f33","./zh-cn":"5c3a","./zh-cn.js":"5c3a","./zh-hk":"49ab","./zh-hk.js":"49ab","./zh-mo":"3a6c","./zh-mo.js":"3a6c","./zh-tw":"90ea","./zh-tw.js":"90ea"};function n(e){var t=r(e);return s(t)}function r(e){if(!s.o(i,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return i[e]}n.keys=function(){return Object.keys(i)},n.resolve=r,e.exports=n,n.id="4678"},"782c":function(e,t,s){e.exports=s.p+"assets/media/rezzo.b0ef15d8.wav"},"7df7":function(module,__webpack_exports__,__webpack_require__){"use strict";var tslib__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("9ab4"),vue_class_component__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("ce1f"),axios__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("bc3a"),axios__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(axios__WEBPACK_IMPORTED_MODULE_2__),lodash__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("2ef0"),lodash__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(lodash__WEBPACK_IMPORTED_MODULE_3__),Props=function(){function e(){this.artist=Object(vue_class_component__WEBPACK_IMPORTED_MODULE_1__["c"])({default:[]}),this.trackName=Object(vue_class_component__WEBPACK_IMPORTED_MODULE_1__["c"])({default:"",required:!0}),this.porcentElapsed=Object(vue_class_component__WEBPACK_IMPORTED_MODULE_1__["c"])({default:0,required:!0}),this.geniusKey=Object(vue_class_component__WEBPACK_IMPORTED_MODULE_1__["c"])({})}return e}(),Lyrics=function(_super){function Lyrics(){var e=null!==_super&&_super.apply(this,arguments)||this;return e.loading=!0,e.lyrics=[],e.genius=axios__WEBPACK_IMPORTED_MODULE_2___default.a.create({baseURL:"https://api.genius.com",params:{access_token:e.geniusKey}}),e}return Object(tslib__WEBPACK_IMPORTED_MODULE_0__["c"])(Lyrics,_super),Lyrics.prototype.watchGeniusKey=function(){this.genius=axios__WEBPACK_IMPORTED_MODULE_2___default.a.create({baseURL:"https://api.genius.com",params:{access_token:this.geniusKey}})},Object.defineProperty(Lyrics.prototype,"currentIndex",{get:function(){if(!this.lyrics)return 0;var e=Math.round(this.lyrics.length*this.porcentElapsed/100);return e},enumerable:!1,configurable:!0}),Lyrics.prototype.watchTrackName=function(){var _a;return Object(tslib__WEBPACK_IMPORTED_MODULE_0__["a"])(this,void 0,void 0,(function(){var search,firstResult,song,div,scriptURL,scriptTxt,jsonline,jsonPart,lyrics,span,blocks,lyricsWithoutHTML,cleanedLyrics,_this=this;return Object(tslib__WEBPACK_IMPORTED_MODULE_0__["d"])(this,(function(_b){switch(_b.label){case 0:return this.lyrics=[],console.log("track name changed",this.trackName),""==this.trackName?[2]:[4,this.genius.get("/search",{params:{q:this.artist+" "+this.trackName}}).then((function(e){var t;return null===(t=e.data.response)||void 0===t?void 0:t.hits}))];case 1:return search=_b.sent(),console.log("find",search),search&&0!=search.length?[3,3]:[4,this.genius.get("/search",{params:{q:""+this.trackName}}).then((function(e){var t;return null===(t=e.data.response)||void 0===t?void 0:t.hits}))];case 2:search=_b.sent(),console.log("find",search),_b.label=3;case 3:return search&&0!=search.length?(firstResult=search.filter((function(e){return"song"===e.type}))[0],[4,this.genius.get(firstResult.result.api_path).then((function(e){return e.data.response.song}))]):[2];case 4:return song=_b.sent(),console.log("found song",song),div=document.createElement("div"),div.innerHTML=song.embed_content.replace("src='//","src='http://").trim(),scriptURL=(null===(_a=div.querySelector("script"))||void 0===_a?void 0:_a.src)||"",[4,fetch(scriptURL).then((function(e){return e.text()}))];case 5:return scriptTxt=_b.sent(),jsonline=scriptTxt.split("\n").find((function(e){return e.match(/document.write\(JSON.parse/)})),jsonline?(jsonPart=jsonline.replace(/^.*document.write\(/,"").replace(/\)$/,""),lyrics=eval(jsonPart),span=document.createElement("span"),span.innerHTML=lyrics,blocks=span.querySelector(".rg_embed_body"),blocks&&(lyrics=blocks.innerHTML),lyricsWithoutHTML=lyrics.split("\n").map((function(e){return _this.extractContent(e,!0)})),cleanedLyrics=lodash__WEBPACK_IMPORTED_MODULE_3___default.a.reduce(lyricsWithoutHTML,(function(e,t,s){return s?""===e[e.length-1].trim()&&""===t.trim()||t.match(/\[.*\]/)?e:Object(tslib__WEBPACK_IMPORTED_MODULE_0__["e"])(e,[t]):[t]}),[]),this.lyrics=cleanedLyrics,div.innerHTML=cleanedLyrics.join("<br>"),[2]):[2]}}))}))},Lyrics.prototype.extractContent=function(e,t){var s=document.createElement("span");if(s.innerHTML=e,t)for(var i=s.querySelectorAll("*"),n=0;n<i.length;n++)i[n].textContent&&(i[n].textContent+=" ");return[s.textContent||s.innerText].toString().replace(/ +/g," ")},Lyrics.prototype.mounted=function(){return Object(tslib__WEBPACK_IMPORTED_MODULE_0__["a"])(this,void 0,void 0,(function(){return Object(tslib__WEBPACK_IMPORTED_MODULE_0__["d"])(this,(function(e){return console.log("lyrics mounted",this.trackName),this.watchTrackName(),[2]}))}))},Lyrics=Object(tslib__WEBPACK_IMPORTED_MODULE_0__["b"])([Object(vue_class_component__WEBPACK_IMPORTED_MODULE_1__["a"])({components:{},watch:{trackName:"watchTrackName",geniusKey:"watchGeniusKey"}})],Lyrics),Lyrics}(vue_class_component__WEBPACK_IMPORTED_MODULE_1__["b"].with(Props));__webpack_exports__["a"]=Lyrics},ba8c:function(e,t,s){},c4d4:function(e,t,s){},c57f:function(e,t,s){"use strict";s("c4d4")},cd49:function(e,t,s){"use strict";s.r(t);var i=s("7a23");const n=Object(i["createVNode"])("link",{href:"https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css",rel:"stylesheet",integrity:"sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC",crossorigin:"anonymous"},null,-1),r={key:0,src:"https://visualizer.ianfox.be/visual.php",allow:"microphone"},a={key:1,class:"iframe"},c={class:"overlay"},o={class:"nav nav-tabs"},l={class:"nav-item"},u={class:"nav-item"},p={class:"nav-item"},d={class:"flex"},f=Object(i["createVNode"])("br",null,null,-1),b=Object(i["createVNode"])("br",null,null,-1),y=Object(i["createVNode"])("button",{type:"submit"},"Save",-1),h=Object(i["createVNode"])("br",null,null,-1),m=Object(i["createTextVNode"])(" Sound Visualizer : "),_={class:"list-group"},j={class:"list-group"},k={class:"flex-auto"},g={class:"flex-initial"},O={class:"list-group"};function v(e,t,s,v,P,T){const x=Object(i["resolveComponent"])("playlist"),A=Object(i["resolveComponent"])("draggable"),E=Object(i["resolveComponent"])("player"),w=Object(i["resolveComponent"])("lyrics");return Object(i["openBlock"])(),Object(i["createBlock"])(i["Fragment"],null,[n,e.soundVisualizer?(Object(i["openBlock"])(),Object(i["createBlock"])("iframe",r)):(Object(i["openBlock"])(),Object(i["createBlock"])("div",a)),Object(i["createVNode"])("div",c,[Object(i["createVNode"])("ul",o,[Object(i["createVNode"])("li",l,[Object(i["createVNode"])("button",{class:"nav-link",onClick:t[1]||(t[1]=t=>e.login())},"Login")]),Object(i["createVNode"])("li",u,[Object(i["createVNode"])("button",{class:["nav-link",{active:"settings"===e.menu}],onClick:t[2]||(t[2]=t=>e.menu="settings")}," Settings ",2)]),Object(i["createVNode"])("li",p,[Object(i["createVNode"])("button",{class:["nav-link",{active:"spotimix"===e.menu}],onClick:t[3]||(t[3]=t=>e.menu="spotimix")}," Spotimix ",2)])]),Object(i["createVNode"])("div",d,[Object(i["createVNode"])("div",{class:"flex-initial",hidden:"settings"!==e.menu},[Object(i["createVNode"])("form",{onSubmit:t[7]||(t[7]=t=>e.setCredentials())},[Object(i["withDirectives"])(Object(i["createVNode"])("input",{"onUpdate:modelValue":t[4]||(t[4]=t=>e.input_genius=t),placeholder:"genius key"},null,512),[[i["vModelText"],e.input_genius]]),f,Object(i["withDirectives"])(Object(i["createVNode"])("input",{"onUpdate:modelValue":t[5]||(t[5]=t=>e.input_spotify=t),placeholder:"spotify key"},null,512),[[i["vModelText"],e.input_spotify]]),b,y,h,m,Object(i["withDirectives"])(Object(i["createVNode"])("input",{type:"checkbox","onUpdate:modelValue":t[6]||(t[6]=t=>e.soundVisualizer=t)},null,512),[[i["vModelCheckbox"],e.soundVisualizer]])],32),Object(i["createVNode"])("div",_,[(Object(i["openBlock"])(!0),Object(i["createBlock"])(i["Fragment"],null,Object(i["renderList"])(e.playlists,t=>(Object(i["openBlock"])(),Object(i["createBlock"])("div",{class:"list-group-item",key:t.id},[Object(i["createVNode"])("div",null,[Object(i["createTextVNode"])(Object(i["toDisplayString"])(t.name)+" ",1),e.selectedPlaylists.find(e=>e.id===t.id)?(Object(i["openBlock"])(),Object(i["createBlock"])("button",{key:1,class:"btn btn-warning",onClick:s=>e.unselectPlaylist(t)}," Remove ",8,["onClick"])):(Object(i["openBlock"])(),Object(i["createBlock"])("button",{key:0,class:"btn btn-success",onClick:s=>e.selectPlaylist(t)}," Add ",8,["onClick"]))])]))),128))])],8,["hidden"]),Object(i["createVNode"])("div",{class:"flex-initial",hidden:"spotimix"!==e.menu},[Object(i["createVNode"])("button",{class:"btn btn-primary self-center",onClick:t[8]||(t[8]=t=>e.generateSpotimix())}," Generate Spotimix "),Object(i["createVNode"])("div",j,[Object(i["createVNode"])(A,{modelValue:e.selectedPlaylists,"onUpdate:modelValue":t[10]||(t[10]=t=>e.selectedPlaylists=t),class:"dragArea list-group w-full","item-key":"id"},{item:Object(i["withCtx"])(({element:s})=>[Object(i["createVNode"])("div",{class:["playlist list-group-item",{"list-group-item-default":!e.playlistRefsVue[s.id]||!e.playlistRefsVue[s.id].isActive,"list-group-item-success":e.playlistRefsVue[s.id]&&e.playlistRefsVue[s.id].isActive}]},[Object(i["createVNode"])(x,{ref:t=>t&&(e.playlistRefsVue[s.id]=t),spotimix:e.spotimixTracks,playlist_id:s.id,playlist_name:s.name,access_token:e.spotifyApi.getAccessToken(),playing_track:e.playing_track},null,8,["spotimix","playlist_id","playlist_name","access_token","playing_track"]),Object(i["withDirectives"])(Object(i["createVNode"])("input",{class:"form-control form-control-sm",type:"number",min:"0","onUpdate:modelValue":t=>e.playlistRepartition[s.id]=t,onChange:t[9]||(t[9]=(...t)=>e.savePlaylistRepartition&&e.savePlaylistRepartition(...t))},null,40,["onUpdate:modelValue"]),[[i["vModelText"],e.playlistRepartition[s.id],void 0,{number:!0}]])],2)]),_:1},8,["modelValue"])])],8,["hidden"]),Object(i["createVNode"])("div",k,[Object(i["createVNode"])(E,{access_token:e.access_token,onNext:t[11]||(t[11]=t=>e.setPlayingTrack())},null,8,["access_token"]),e.currentPlayingTrack?(Object(i["openBlock"])(),Object(i["createBlock"])(w,{key:0,trackName:e.currentPlayingTrack.name,artist:e.currentPlayingTrack.artists[0].name,porcentElapsed:this.porcentElapsed,geniusKey:this.geniusKey},null,8,["trackName","artist","porcentElapsed","geniusKey"])):Object(i["createCommentVNode"])("",!0)]),Object(i["createVNode"])("div",g,[Object(i["createVNode"])("div",O,[(Object(i["openBlock"])(!0),Object(i["createBlock"])(i["Fragment"],null,Object(i["renderList"])(e.trackPreview.slice(0,15),t=>(Object(i["openBlock"])(),Object(i["createBlock"])("div",{class:"list-group-item",key:t.id},[Object(i["createVNode"])("div",null,[Object(i["createVNode"])("img",{class:"float-left",src:e.getTrackImage(t)},null,8,["src"]),Object(i["createTextVNode"])(" "+Object(i["toDisplayString"])(t.name),1)])]))),128))])])])])],64)}var P=s("9ab4"),T=s("ce1f"),x=s("399f"),A=s("2ef0"),E=s.n(A);function w(e,t,s,n,r,a){return Object(i["openBlock"])(),Object(i["createBlock"])("div",null,Object(i["toDisplayString"])(e.playlist_name)+" ("+Object(i["toDisplayString"])(e.alreadyListenedTracks.length)+"/"+Object(i["toDisplayString"])(e.alreadyListenedTracks.length+e.tracksToListen.length)+") ",1)}var V=function(){function e(){this.spotimix=Object(T["c"])({default:[]}),this.playlist_id=Object(T["c"])({default:"",required:!0}),this.playlist_name=Object(T["c"])({default:"",required:!0}),this.access_token=Object(T["c"])({default:"",required:!0}),this.playing_track=Object(T["c"])({default:""})}return e}(),M=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.loading=!0,t.tracksRaw=[],t.spotifyApi=new x["a"],t}return Object(P["c"])(t,e),t.prototype.setAccessToken=function(){this.spotifyApi.setAccessToken(this.access_token)},t.prototype.mounted=function(){return Object(P["a"])(this,void 0,void 0,(function(){var e,t,s;return Object(P["d"])(this,(function(i){switch(i.label){case 0:if(this.loading=!0,!this.playlist_id||!this.access_token)return[2];this.spotifyApi.setAccessToken(this.access_token),e=0,t=100,i.label=1;case 1:return[4,this.spotifyApi.playlists.getPlaylistItems(this.playlist_id,{offset:e,limit:t})];case 2:s=i.sent(),this.tracksRaw=this.tracksRaw.concat(s.items),e=this.tracksRaw.length,i.label=3;case 3:if(s.items.length===t)return[3,1];i.label=4;case 4:return[2]}}))}))},Object.defineProperty(t.prototype,"isActive",{get:function(){var e=this;return void 0!==this.tracksRaw.find((function(t){return t.track.uri===e.playing_track}))},enumerable:!1,configurable:!0}),t.prototype.shuffle=function(e){for(var t,s=e.length-1;s>0;s--){var i=Math.floor(Math.random()*(s+1));t=[e[i],e[s]],e[s]=t[0],e[i]=t[1]}return e},Object.defineProperty(t.prototype,"tracksToListen",{get:function(){var e=this;return this.shuffle(this.tracksRaw.map((function(e){return e.track.uri})).filter((function(t){return!e.alreadyListenedTracks.includes(t)})))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"alreadyListenedTracks",{get:function(){var e=this;if(!this.spotimix)return[];var t=this.spotimix.findIndex((function(t){return t===e.playing_track}));return-1===t?(console.log("track not found in spotimix"),[]):this.spotimix.slice(0,t+1).filter((function(t){return e.tracksRaw.find((function(e){return e.track.uri===t}))}))},enumerable:!1,configurable:!0}),t=Object(P["b"])([Object(T["a"])({components:{},watch:{access_token:"setAccessToken"}})],t),t}(T["b"].with(V)),N=M;N.render=w;var I=N;const L={class:"text-6xl"},R=Object(i["createVNode"])("br",null,null,-1);function D(e,t,s,n,r,a){return Object(i["openBlock"])(),Object(i["createBlock"])("div",null,[Object(i["createVNode"])("p",L,[(Object(i["openBlock"])(!0),Object(i["createBlock"])(i["Fragment"],null,Object(i["renderList"])(e.lyrics,(t,s)=>(Object(i["openBlock"])(),Object(i["createBlock"])("span",{key:s},[Object(i["createVNode"])("span",{hidden:s<e.currentIndex-5||s>e.currentIndex+7},[Object(i["createTextVNode"])(Object(i["toDisplayString"])(t),1),R],8,["hidden"])]))),128))])])}var B=s("7df7");B["a"].render=D;var C=B["a"];function S(e,t,s,n,r,a){return Object(i["openBlock"])(),Object(i["createBlock"])("div",null,[Object(i["createVNode"])("button",{class:"btn btn-success",onClick:t[1]||(t[1]=t=>e.play())},"Play"),Object(i["createVNode"])("button",{class:"btn btn-primary",onClick:t[2]||(t[2]=t=>e.pause())},"Pause"),Object(i["createVNode"])("button",{class:"btn btn-warning",onClick:t[3]||(t[3]=t=>e.next())},"Next")])}s("782c");var U=function(){function e(){this.access_token=Object(T["c"])({default:""})}return e}(),z=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.loading=!0,t.spotifyApi=new x["a"],t}return Object(P["c"])(t,e),t.prototype.setAccessToken=function(){this.spotifyApi.setAccessToken(this.access_token)},t.prototype.play=function(){this.spotifyApi.player.play(),this.$emit("next")},t.prototype.pause=function(){this.spotifyApi.player.pause()},t.prototype.next=function(){return Object(P["a"])(this,void 0,void 0,(function(){var e,t;return Object(P["d"])(this,(function(i){switch(i.label){case 0:return e=function(e){return new Promise((function(t){return setTimeout(t,e)}))},t=new Audio(s("782c")),[4,this.spotifyApi.player.setVolume(80)];case 1:return i.sent(),t.volume=.3,[4,t.play()];case 2:return i.sent(),[4,e(3e3)];case 3:return i.sent(),t.volume=.5,[4,this.spotifyApi.player.setVolume(50)];case 4:return i.sent(),[4,e(1e3)];case 5:return i.sent(),t.volume=1,[4,this.spotifyApi.player.setVolume(30)];case 6:return i.sent(),[4,this.spotifyApi.player.skipToNext()];case 7:return i.sent(),[4,e(1e3)];case 8:return i.sent(),t.volume=.5,[4,this.spotifyApi.player.setVolume(50)];case 9:return i.sent(),[4,e(1e3)];case 10:return i.sent(),t.volume=.3,[4,this.spotifyApi.player.setVolume(80)];case 11:return i.sent(),[4,e(3e3)];case 12:return i.sent(),t.volume=.3,[4,this.spotifyApi.player.setVolume(100)];case 13:return i.sent(),[4,t.pause()];case 14:return i.sent(),this.$emit("next"),[2]}}))}))},t=Object(P["b"])([Object(T["a"])({components:{},emits:["next"],watch:{access_token:"setAccessToken"}})],t),t}(T["b"].with(U)),K=z;K.render=S;var W=K,q=s("b76a"),H=s.n(q),J=s("c1df"),F=s.n(J),G="adc341012eea48f581d67ff19d55b250",Q=location.href,$="user-read-private user-read-email user-library-read playlist-modify-public playlist-modify-private playlist-read-private playlist-read-collaborative user-library-modify user-library-read user-read-recently-played user-top-read user-read-playback-position user-top-read user-read-playback-position user-read-playback-state user-modify-playback-state user-read-currently-playing app-remote-control streaming",Y=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.input_genius=localStorage.getItem("genius_key")||"",t.input_spotify=localStorage.getItem("spotify_key")||"",t.soundVisualizer="true"===localStorage.getItem("sound_visualizer"),t.spotifyApi=new x["a"]({clientSecret:t.input_spotify,clientId:G,redirectUri:Q}),t.geniusKey=t.input_genius,t.access_token="",t.playlists=[],t.spotimix=[],t.spotimixId="",t.playing_track="",t.menu="settings",t.tracksImage={},t.trackDuration={startTime:F()(),duration:0},t.porcentElapsed=0,t.playlistRefsVue={},t.playlistRepartition={},t.selectedPlaylists=[],t}return Object(P["c"])(t,e),t.prototype.setCredentials=function(){this.spotifyApi=new x["a"]({clientSecret:this.input_spotify,clientId:G,redirectUri:Q}),localStorage.setItem("genius_key",this.input_genius),localStorage.setItem("spotify_key",this.input_spotify),this.mounted()},t.prototype.saveSoundVisualizer=function(){localStorage.setItem("sound_visualizer",""+this.soundVisualizer)},t.prototype.savePlaylistRepartition=function(){console.log("save repartition"),localStorage.setItem("playlistRepartition",JSON.stringify(this.playlistRepartition))},t.prototype.initPlaylistRepartition=function(){this.playlistRepartition=JSON.parse(localStorage.getItem("playlistRepartition")||"{}")},t.prototype.getTrackImage=function(e){var t;return null===(t=e.album.images.find((function(e){return 64===e.width})))||void 0===t?void 0:t.url},t.prototype.updatePorcentElapsed=function(){var e=this;this.porcentElapsed=Math.round(F.a.duration(F()().diff(this.trackDuration.startTime)).asMilliseconds()/(this.trackDuration.duration||1)*100),setTimeout((function(){return e.updatePorcentElapsed()}),1e3)},Object.defineProperty(t.prototype,"trackPreview",{get:function(){return this.currentPlayingTrack?Object(P["e"])([this.currentPlayingTrack],this.tracksAfter):this.tracksAfter},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"spotimixTracks",{get:function(){return this.spotimix.map((function(e){return e.uri}))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"currentPlayingTrack",{get:function(){var e=this;return this.spotimix.find((function(t){return t.uri===e.playing_track}))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"refreshToken",{get:function(){return localStorage.getItem("refresh_token")},set:function(e){e?localStorage.setItem("refresh_token",e):localStorage.removeItem("refresh_token")},enumerable:!1,configurable:!0}),t.prototype.saveSelectedPlaylists=function(){console.log("save selected"),localStorage.setItem("selected_playlists",JSON.stringify(this.selectedPlaylists))},t.prototype.initSelectedPlaylists=function(){this.selectedPlaylists=JSON.parse(localStorage.getItem("selected_playlists")||"[]")},t.prototype.selectPlaylist=function(e){this.selectedPlaylists=E.a.uniqBy(this.selectedPlaylists.concat(e),(function(e){return e.id}))},t.prototype.unselectPlaylist=function(e){this.selectedPlaylists=this.selectedPlaylists.filter((function(t){return t.id!==e.id}))},t.prototype.updateAccessToken=function(){return Object(P["a"])(this,void 0,void 0,(function(){var e,t=this;return Object(P["d"])(this,(function(s){switch(s.label){case 0:return this.refreshToken?[4,this.spotifyApi.getRefreshedAccessToken(this.refreshToken)]:[2];case 1:return e=s.sent(),this.spotifyApi.setAccessToken(e.access_token),this.access_token=e.access_token,setTimeout((function(){return t.updateAccessToken()}),1e3*e.expires_in-6e5),[2]}}))}))},t.prototype.mounted=function(){return Object(P["a"])(this,void 0,void 0,(function(){var e,t,s,i,n,r;return Object(P["d"])(this,(function(a){switch(a.label){case 0:return e=new URLSearchParams(window.location.search).get("code"),e?[4,this.spotifyApi.getRefreshableUserTokens(e)]:[3,2];case 1:t=a.sent(),this.refreshToken=t.refresh_token,window.location.search="",a.label=2;case 2:return this.refreshToken?[4,this.updateAccessToken()]:[3,4];case 3:return a.sent(),[3,5];case 4:this.login(),a.label=5;case 5:return this.initPlaylistRepartition(),this.initSelectedPlaylists(),this.selectedPlaylists.length&&(this.menu="spotimix"),s=this,[4,this.spotifyApi.users.getMe()];case 6:return s.user=a.sent(),i=this,[4,this.spotifyApi.playlists.getMyPlaylists({limit:50}).then((function(e){return e.items}))];case 7:return i.playlists=a.sent(),n=this.playlists.find((function(e){return"spotimix"===e.name})),n?[4,this.spotifyApi.playlists.getPlaylist(n.id)]:[3,9];case 8:return r=a.sent(),[3,11];case 9:return[4,this.spotifyApi.playlists.createPlaylist(this.user.id,"spotimix",{public:!1,collaborative:!1,description:"generated playlist by spotimix application"})];case 10:r=a.sent(),a.label=11;case 11:return this.spotimixId=r.id,this.loadSpotimix(),this.setPlayingTrack(),this.updatePorcentElapsed(),[2]}}))}))},t.prototype.setPlayingTrack=function(){var e,t,s;return Object(P["a"])(this,void 0,void 0,(function(){var i,n,r=this;return Object(P["d"])(this,(function(a){switch(a.label){case 0:return[4,this.spotifyApi.player.getCurrentlyPlayingTrack()];case 1:return i=a.sent(),i&&"track"===i.currently_playing_type&&i.item?(this.playing_track=i.item.uri||"",n=(null===(e=i.item)||void 0===e?void 0:e.duration_ms)-(i.progress_ms||0),this.trackDuration={startTime:F()().add(-((null===(t=i.item)||void 0===t?void 0:t.duration_ms)||0)+n,"milliseconds"),duration:(null===(s=i.item)||void 0===s?void 0:s.duration_ms)||0},setTimeout((function(){return r.setPlayingTrack()}),n+200),[2]):(setTimeout((function(){return r.setPlayingTrack()}),3e4),[2])}}))}))},t.prototype.login=function(){window.location.href="https://accounts.spotify.com/authorize?response_type=code&client_id="+G+"&scope="+encodeURIComponent($)+"&redirect_uri="+encodeURIComponent(Q)},t.prototype.getAllTracksBefore=function(){return Object(P["a"])(this,void 0,Promise,(function(){var e,t;return Object(P["d"])(this,(function(s){switch(s.label){case 0:return this.spotimix?[4,this.spotifyApi.player.getCurrentlyPlayingTrack()]:[2,[]];case 1:return e=s.sent(),t=this.spotimix.findIndex((function(t){var s;return t.uri===(null===(s=e.item)||void 0===s?void 0:s.uri)})),-1===t?(console.log("track not found in spotimix"),[2,[]]):[2,this.spotimix.slice(0,t+1)]}}))}))},Object.defineProperty(t.prototype,"tracksAfter",{get:function(){var e=this;if(!this.spotimix)return[];var t=this.spotimix.findIndex((function(t){return t.uri===e.playing_track}));return-1===t?(console.log("track not found in spotimix"),[]):this.spotimix.slice(t+1)},enumerable:!1,configurable:!0}),t.prototype.loadSpotimix=function(){return Object(P["a"])(this,void 0,void 0,(function(){var e,t,s,i;return Object(P["d"])(this,(function(n){switch(n.label){case 0:console.log("load spotimix"),e=0,t=100,i=[],n.label=1;case 1:return[4,this.spotifyApi.playlists.getPlaylistItems(this.spotimixId,{offset:e,limit:t})];case 2:s=n.sent(),i=i.concat(s.items),e=i.length,n.label=3;case 3:if(s.items.length===t)return[3,1];n.label=4;case 4:return this.spotimix=i.map((function(e){return e.track})),[2]}}))}))},t.prototype.generateSpotimix=function(){return Object(P["a"])(this,void 0,void 0,(function(){var e,t,s,i,n,r,a,c,o,l,u=this;return Object(P["d"])(this,(function(p){switch(p.label){case 0:return this.spotimix?[4,this.loadSpotimix()]:[2];case 1:p.sent(),e=[],t={},this.selectedPlaylists.map((function(e){return e.id})).forEach((function(e){t[e]=u.playlistRefsVue[e].tracksToListen})),s=0;do{s=0,this.selectedPlaylists.forEach((function(i){var n=t[i.id].slice(0,u.playlistRepartition[i.id]);e.push.apply(e,n),t[i.id]=t[i.id].slice(u.playlistRepartition[i.id],t[i.id].length),s+=n.length,console.log("added "+n.length+" elements on playlist "+i.name+", still "+t[i.id].length+" elements to add")}))}while(0!==s);return[4,this.getAllTracksBefore()];case 2:i=p.sent(),e=e.filter((function(e){return!i.find((function(t){return t.uri===e}))})),n=this.tracksAfter,console.log("tracksAfter",n),r=E.a.chunk(n,100),o=0,p.label=3;case 3:return o<r.length?(a=r[o],[4,this.spotifyApi.playlists.removePlaylistItems(this.spotimixId,a.map((function(e){return e.uri})))]):[3,6];case 4:p.sent(),p.label=5;case 5:return o++,[3,3];case 6:c=E.a.chunk(e,100),o=0,p.label=7;case 7:return o<c.length?(l=c[o],[4,this.spotifyApi.playlists.addItemsToPlaylist(this.spotimixId,l.map((function(e){return e})))]):[3,10];case 8:p.sent(),p.label=9;case 9:return o++,[3,7];case 10:return[2]}}))}))},t.prototype.startPlaylist=function(e){return Object(P["a"])(this,void 0,void 0,(function(){var t,s,i,n;return Object(P["d"])(this,(function(r){switch(r.label){case 0:return this.spotimix?(t=this,[4,this.spotifyApi.playlists.getPlaylist(this.spotimixId).then((function(e){return e.tracks.items.map((function(e){return e.track}))}))]):[2];case 1:return t.spotimix=r.sent(),[4,this.spotifyApi.playlists.getPlaylistItems(e.id)];case 2:return s=r.sent().items,[4,this.getAllTracksBefore()];case 3:return i=r.sent(),s=s.filter((function(e){return!i.find((function(t){return t.uri===e.track.uri}))})),n=this.tracksAfter,[4,this.spotifyApi.playlists.removePlaylistItems(this.spotimixId,n.map((function(e){return e.uri})))];case 4:return r.sent(),[4,this.spotifyApi.playlists.addItemsToPlaylist(this.spotimixId,s.map((function(e){return e.track.uri})))];case 5:return r.sent(),[2]}}))}))},t.prototype.copyToCloud=function(e){var t;return Object(P["a"])(this,void 0,void 0,(function(){var s,i,n,r,a,c,o=this;return Object(P["d"])(this,(function(l){switch(l.label){case 0:return this.user?[4,this.spotifyApi.playlists.getPlaylistItems(e.id)]:[2];case 1:return s=l.sent(),i=e.name+"-cloud",n=null===(t=this.playlists.find((function(e){return e.name===i})))||void 0===t?void 0:t.id,n?[3,3]:[4,this.spotifyApi.playlists.createPlaylist(this.user.id,i,{public:e.public||!1,collaborative:e.collaborative||!1,description:e.description||void 0})];case 2:r=l.sent(),n=r.id,l.label=3;case 3:return a=n,[4,Promise.all(s.items.map((function(e){return Object(P["a"])(o,void 0,void 0,(function(){var t;return Object(P["d"])(this,(function(s){switch(s.label){case 0:return e.is_local?[4,this.spotifyApi.search.searchTracks(e.track.name,{limit:1})]:[3,2];case 1:return t=s.sent(),t.items[0]?[2,t.items[0].uri]:(console.log("fail to find track with name",e.track.name),[2,""]);case 2:return[2,e.track.uri];case 3:return[2]}}))}))})))];case 4:return c=l.sent(),this.spotifyApi.playlists.addItemsToPlaylist(a,c.filter((function(e){return e}))),[2]}}))}))},t=Object(P["b"])([Object(T["a"])({components:{playlist:I,draggable:H.a,lyrics:C,player:W},watch:{playlistRepartition:"savePlaylistRepartition",selectedPlaylists:"saveSelectedPlaylists",soundVisualizer:"saveSoundVisualizer"}})],t),t}(T["b"]),X=Y;s("c57f");X.render=v;var Z=X;s("ba8c");Object(i["createApp"])(Z).mount("#app")}});
//# sourceMappingURL=app.9c8d7db2.js.map